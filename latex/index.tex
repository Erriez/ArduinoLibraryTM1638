\href{https://travis-ci.org/Erriez/ErriezTM1638}{\tt }

This is a 3-\/pin serial \hyperlink{class_t_m1638}{T\+M1638} chip library for Arduino, optimized for size and speed. It supports a combined L\+ED driver controller and key-\/scan interface to detect multiple key presses at the same time.



Displaying numbers, characters and reading keys depends on the hardware wiring and is not part of this library. A fully operational example for a board with 8 7-\/segment displays, 8 dual color L\+ED\textquotesingle{}s and 8 buttons which uses this library is available here\+: \href{https://github.com/Erriez/ErriezLKM1638}{\tt J\+Y-\/\+L\+K\+M1638}.

\subsection*{Hardware}

Connect power and 3 data pins to an Arduino board D\+I\+G\+I\+T\+AL pins\+:
\begin{DoxyItemize}
\item V\+DD (Power 3.\+3V -\/ 5V)
\item G\+ND (Ground)
\item D\+IO (Bi-\/directional data input/output)
\item S\+TB (Chip select)
\item C\+LK (Clock)
\end{DoxyItemize}

The following \hyperlink{class_t_m1638}{T\+M1638} pins should be connected to L\+ED\textquotesingle{}s and buttons in a matrix\+:
\begin{DoxyItemize}
\item K1$\sim$\+K3 (Key-\/scan data input to read multiple key presses at the same time)
\item S\+E\+G/\+G\+R\+ID (Output for L\+ED matrix)
\end{DoxyItemize}

\subsection*{Pins}

\tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*5{|X[-1]}|}
\hline
\rowcolor{\tableheadbgcolor}\PBS\centering {\bf Pin }&\PBS\centering {\bf \hyperlink{class_t_m1638}{T\+M1638} }&\PBS\centering {\bf Arduino U\+NO / Nano / Micro / Pro Micro / Leonardo / Mega2560 }&\PBS\centering {\bf We\+Mos D1 \& R2 / Node M\+CU }&\PBS\centering {\bf We\+Mos L\+O\+L\+I\+N32  }\\\cline{1-5}
\endfirsthead
\hline
\endfoot
\hline
\rowcolor{\tableheadbgcolor}\PBS\centering {\bf Pin }&\PBS\centering {\bf \hyperlink{class_t_m1638}{T\+M1638} }&\PBS\centering {\bf Arduino U\+NO / Nano / Micro / Pro Micro / Leonardo / Mega2560 }&\PBS\centering {\bf We\+Mos D1 \& R2 / Node M\+CU }&\PBS\centering {\bf We\+Mos L\+O\+L\+I\+N32  }\\\cline{1-5}
\endhead
\PBS\centering 1 &\PBS\centering V\+CC &\PBS\centering 5V (or 3.\+3V) &\PBS\centering 3\+V3 &\PBS\centering 3\+V3 \\\cline{1-5}
\PBS\centering 2 &\PBS\centering G\+ND &\PBS\centering G\+ND &\PBS\centering G\+ND &\PBS\centering G\+ND \\\cline{1-5}
\PBS\centering 3 &\PBS\centering C\+LK &\PBS\centering 2 (D\+I\+G\+I\+T\+AL pin) &\PBS\centering D2 &\PBS\centering 0 \\\cline{1-5}
\PBS\centering 4 &\PBS\centering D\+IO &\PBS\centering 3 (D\+I\+G\+I\+T\+AL pin) &\PBS\centering D3 &\PBS\centering 4 \\\cline{1-5}
\PBS\centering 5 &\PBS\centering S\+T\+B0 &\PBS\centering 4 (D\+I\+G\+I\+T\+AL pin) &\PBS\centering D4 &\PBS\centering 5 \\\cline{1-5}
\end{longtabu}

\begin{DoxyItemize}
\item Check maximum regulator / diode current to prevent a burnout when using lots of L\+ED\textquotesingle{}s. Some boards can provide only 100mA, others 800mA max.
\end{DoxyItemize}

\subsection*{Example}


\begin{DoxyItemize}
\item Examples $\vert$ Erriez \hyperlink{class_t_m1638}{T\+M1638} $\vert$ \href{https://github.com/Erriez/ErriezTM1638/blob/master/examples/Example/Example.ino}{\tt Example}
\end{DoxyItemize}

\subsection*{Documentation}


\begin{DoxyItemize}
\item \href{https://Erriez.github.io/ErriezTM1638}{\tt Doxygen online H\+T\+ML}
\item \href{https://github.com/Erriez/ErriezTM1638/raw/gh-pages/latex/ErriezTM1638.pdf}{\tt Doxygen P\+DF}
\item \href{https://github.com/Erriez/ErriezTM1638/blob/master/extras/TM1638_datasheet.pdf}{\tt T\+M1638 Datasheet}
\end{DoxyItemize}

\subsection*{Usage}

{\bfseries Initialization}


\begin{DoxyCode}
1 \{c++\}
2 // Include TM1638 library
3 #include "TM1638.h"
4 
5 // Connect display pins to the Arduino DIGITAL pins
6 #define TM1638\_CLK\_PIN   2
7 #define TM1638\_DIO\_PIN   3
8 #define TM1638\_STB\_PIN   4
9 
10 // Create tm1638 object
11 TM1638 tm1638(TM1638\_CLK\_PIN, TM1638\_DIO\_PIN, TM1638\_STB\_PIN);
12 
13 void setup()
14 \{
15     // Initialize TM1638
16     tm1638.begin();
17 \}
\end{DoxyCode}


{\bfseries Display on/off}


\begin{DoxyCode}
1 \{c++\}
2 // Turn display off
3 tm1638.displayOff();
4 
5 // Turn display on
6 tm1638.displayOn();
\end{DoxyCode}


{\bfseries Turn all L\+ED\textquotesingle{}s off}


\begin{DoxyCode}
1 \{c++\}
2 // Turn all LED's off
3 tm1638.clear();
\end{DoxyCode}


{\bfseries Get keys}


\begin{DoxyCode}
1 \{c++\}
2 // Get 32-bit key-scan
3 uint32\_t keys = tm1638.getKeys();
\end{DoxyCode}


{\bfseries Write Byte to display register}


\begin{DoxyCode}
1 \{c++\}
2 // Write segment LED's to the first display registers 0x00..0x0F with value 0x00..0xff to
3 // display numbers and characters. Just an example which depends on the hardware:
4 tm1638.writeData(0x01, 0x01);
\end{DoxyCode}


{\bfseries Write buffer to display registers}


\begin{DoxyCode}
1 \{c++\}
2 // Creat buffer with LED's
3 uint8\_t buf[] = \{ 0b10000110, 0b00111111, 0b00111111, 0b00111111, 0b00111111, 0b00111111\};
4 
5 // Write buffer to TM1638
6 tm1638.writeData(0x00, buf, sizeof(buf));
\end{DoxyCode}


\subsection*{Small footprint}

Measured with Arduino I\+DE v1.\+8.\+5 without any other peripherals, calling all library functions once\+:

\tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*5{|X[-1]}|}
\hline
\rowcolor{\tableheadbgcolor}{\bf Board }&\PBS\centering {\bf M\+CU flash size }&\PBS\centering {\bf M\+CU R\+AM size }&\PBS\centering {\bf \hyperlink{class_t_m1638}{T\+M1638} library flash }&\PBS\centering {\bf \hyperlink{class_t_m1638}{T\+M1638} library R\+AM  }\\\cline{1-5}
\endfirsthead
\hline
\endfoot
\hline
\rowcolor{\tableheadbgcolor}{\bf Board }&\PBS\centering {\bf M\+CU flash size }&\PBS\centering {\bf M\+CU R\+AM size }&\PBS\centering {\bf \hyperlink{class_t_m1638}{T\+M1638} library flash }&\PBS\centering {\bf \hyperlink{class_t_m1638}{T\+M1638} library R\+AM  }\\\cline{1-5}
\endhead
Arduino U\+NO &\PBS\centering 32kB &\PBS\centering 2048kB &\PBS\centering 1840 Bytes &\PBS\centering 40 Bytes \\\cline{1-5}
\end{longtabu}
\subsection*{Optimized timing}

The library uses optimized pin control for A\+VR targets. Other targets uses the default digital\+Read() and digital\+Write() pin control functions.

Output \href{https://github.com/Erriez/ErriezTM1638/blob/master/examples/Benchmark/Benchmark.ino}{\tt Benchmark} example\+:

\tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*6{|X[-1]}|}
\hline
\rowcolor{\tableheadbgcolor}{\bf Board }&\PBS\centering {\bf C\+LK }&\PBS\centering {\bf Read keys }&\PBS\centering {\bf Write Byte }&\PBS\centering {\bf Write 16 Bytes buffer }&\PBS\centering {\bf Clear display  }\\\cline{1-6}
\endfirsthead
\hline
\endfoot
\hline
\rowcolor{\tableheadbgcolor}{\bf Board }&\PBS\centering {\bf C\+LK }&\PBS\centering {\bf Read keys }&\PBS\centering {\bf Write Byte }&\PBS\centering {\bf Write 16 Bytes buffer }&\PBS\centering {\bf Clear display  }\\\cline{1-6}
\endhead
Pro Mini 8\+M\+Hz &\PBS\centering 65k\+Hz &\PBS\centering 736us &\PBS\centering 312us &\PBS\centering 2448us &\PBS\centering 2224us \\\cline{1-6}
U\+NO 16\+M\+Hz &\PBS\centering 125k\+Hz &\PBS\centering 340us &\PBS\centering 152us &\PBS\centering 1192us &\PBS\centering 1176us \\\cline{1-6}
We\+Mos D1 \& R2 80\+M\+Hz &\PBS\centering 200k\+Hz &\PBS\centering 284us &\PBS\centering 116us &\PBS\centering 683us &\PBS\centering 682us \\\cline{1-6}
We\+Mos D1 \& R2 160\+M\+Hz &\PBS\centering 300k\+Hz &\PBS\centering 223us &\PBS\centering 66us &\PBS\centering 474us &\PBS\centering 469us \\\cline{1-6}
\end{longtabu}
\paragraph*{Arduino U\+NO 16\+M\+Hz}



\paragraph*{We\+Mos D1 \& R2 80\+M\+Hz}



\paragraph*{We\+Mos D1 \& R2 160\+M\+Hz}



\subsection*{Library dependencies}


\begin{DoxyItemize}
\item The \href{https://github.com/Erriez/ErriezTM1638/blob/master/examples/Benchmark/Benchmark.ino}{\tt Benchmark} example uses \href{https://github.com/Erriez/ErriezTimestamp}{\tt Erriez Timestamp} library.
\end{DoxyItemize}

\subsection*{Library installation}

Please refer to the \href{https://github.com/Erriez/ErriezArduinoLibrariesAndSketches/wiki}{\tt Wiki} page.

\subsection*{Other Arduino Libraries and Sketches from Erriez}


\begin{DoxyItemize}
\item \href{https://github.com/Erriez/ErriezArduinoLibrariesAndSketches}{\tt Erriez Libraries and Sketches} 
\end{DoxyItemize}